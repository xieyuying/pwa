System.register(["path","@babel/template"],function(d){"use strict";var o,s;return{setters:[function(l){o=l.default},function(l){s=l.default}],execute:function(){d("default",b);function l({types:i}){return{visitor:{ExportDefaultDeclaration(e,t){const{node:n}=e;if(i.isCallExpression(n.declaration)&&c(i,n.declaration.callee)){const a=t.filename||"unknown";let r=o.basename(a,o.extname(a));r==="index"&&(r=o.basename(o.dirname(a)));const m=s(`
          const %%atomIdentifier%% = %%atom%%;
          export default %%atomIdentifier%%
          `)({atomIdentifier:i.identifier(r),atom:n.declaration});e.replaceWithMultiple(m)}},VariableDeclarator(e){i.isIdentifier(e.node.id)&&i.isCallExpression(e.node.init)&&c(i,e.node.init.callee)&&e.parentPath.insertAfter(i.expressionStatement(i.assignmentExpression("=",i.memberExpression(i.identifier(e.node.id.name),i.identifier("debugLabel")),i.stringLiteral(e.node.id.name))))}}}}function c(i,e){if(i.isIdentifier(e)&&e.name==="atom")return!0;if(i.isMemberExpression(e)){const{property:t}=e;if(i.isIdentifier(t)&&t.name==="atom")return!0}return!1}function u(i,e){if(i.isIdentifier(e)&&e.name==="atom")return!0;if(i.isMemberExpression(e)){const{property:t}=e;if(i.isIdentifier(t)&&t.name==="atom")return!0}return!1}function p({types:i}){return{pre({opts:e}){if(!e.filename)throw new Error("Filename must be available")},visitor:{Program:{exit(e){const t=s(`
          globalThis.jotaiAtomCache = globalThis.jotaiAtomCache || {
            cache: new Map(),
            get(name, inst) { 
              if (this.cache.has(name)) {
                return this.cache.get(name)
              }
              this.cache.set(name, inst)
              return inst
            },
          }`)();e.unshiftContainer("body",t)}},ExportDefaultDeclaration(e,t){const{node:n}=e;if(i.isCallExpression(n.declaration)&&u(i,n.declaration.callee)){const r=`${t.filename||"unknown"}/defaultExport`,m=s("export default globalThis.jotaiAtomCache.get(%%atomKey%%, %%atom%%)")({atomKey:i.stringLiteral(r),atom:n.declaration});e.replaceWith(m)}},VariableDeclarator(e,t){var n,a;if(i.isIdentifier(e.node.id)&&i.isCallExpression(e.node.init)&&u(i,e.node.init.callee)&&(((n=e.parentPath.parentPath)==null?void 0:n.isProgram())||((a=e.parentPath.parentPath)==null?void 0:a.isExportNamedDeclaration()))){const f=`${t.filename||"unknown"}/${e.node.id.name}`,x=s("const %%atomIdentifier%% = globalThis.jotaiAtomCache.get(%%atomKey%%, %%atom%%)")({atomIdentifier:i.identifier(e.node.id.name),atomKey:i.stringLiteral(f),atom:e.node.init});e.parentPath.replaceWith(x)}}}}}function b(){return{plugins:[l,p]}}}}});
