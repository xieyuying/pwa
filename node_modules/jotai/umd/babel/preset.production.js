!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("path"),require("@babel/template")):"function"==typeof define&&define.amd?define(["exports","path","@babel/template"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).jotaiPreset={},e.path,e.templateBuilder)}(this,(function(e,t,n){"use strict";function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=i(t),r=i(n);function o(e){var t=e.types;return{visitor:{ExportDefaultDeclaration:function(e,n){var i=e.node;if(t.isCallExpression(i.declaration)&&l(t,i.declaration.callee)){var o=n.filename||"unknown",f=a.default.basename(o,a.default.extname(o));"index"===f&&(f=a.default.basename(a.default.dirname(o)));var s=r.default("\n          const %%atomIdentifier%% = %%atom%%;\n          export default %%atomIdentifier%%\n          ")({atomIdentifier:t.identifier(f),atom:i.declaration});e.replaceWithMultiple(s)}},VariableDeclarator:function(e){t.isIdentifier(e.node.id)&&t.isCallExpression(e.node.init)&&l(t,e.node.init.callee)&&e.parentPath.insertAfter(t.expressionStatement(t.assignmentExpression("=",t.memberExpression(t.identifier(e.node.id.name),t.identifier("debugLabel")),t.stringLiteral(e.node.id.name))))}}}}function l(e,t){if(e.isIdentifier(t)&&"atom"===t.name)return!0;if(e.isMemberExpression(t)){var n=t.property;if(e.isIdentifier(n)&&"atom"===n.name)return!0}return!1}function f(e,t){if(e.isIdentifier(t)&&"atom"===t.name)return!0;if(e.isMemberExpression(t)){var n=t.property;if(e.isIdentifier(n)&&"atom"===n.name)return!0}return!1}function s(e){var t=e.types;return{pre:function(e){if(!e.opts.filename)throw new Error("Filename must be available")},visitor:{Program:{exit:function(e){var t=r.default("\n          globalThis.jotaiAtomCache = globalThis.jotaiAtomCache || {\n            cache: new Map(),\n            get(name, inst) { \n              if (this.cache.has(name)) {\n                return this.cache.get(name)\n              }\n              this.cache.set(name, inst)\n              return inst\n            },\n          }")();e.unshiftContainer("body",t)}},ExportDefaultDeclaration:function(e,n){var i=e.node;if(t.isCallExpression(i.declaration)&&f(t,i.declaration.callee)){var a=(n.filename||"unknown")+"/defaultExport",o=r.default("export default globalThis.jotaiAtomCache.get(%%atomKey%%, %%atom%%)")({atomKey:t.stringLiteral(a),atom:i.declaration});e.replaceWith(o)}},VariableDeclarator:function(e,n){var i,a;if(t.isIdentifier(e.node.id)&&t.isCallExpression(e.node.init)&&f(t,e.node.init.callee)&&(null!=(i=e.parentPath.parentPath)&&i.isProgram()||null!=(a=e.parentPath.parentPath)&&a.isExportNamedDeclaration())){var o=(n.filename||"unknown")+"/"+e.node.id.name,l=r.default("const %%atomIdentifier%% = globalThis.jotaiAtomCache.get(%%atomKey%%, %%atom%%)")({atomIdentifier:t.identifier(e.node.id.name),atomKey:t.stringLiteral(o),atom:e.node.init});e.parentPath.replaceWith(l)}}}}}e.default=function(){return{plugins:[o,s]}},Object.defineProperty(e,"__esModule",{value:!0})}));
